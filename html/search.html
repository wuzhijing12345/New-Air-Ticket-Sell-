<html>
<head>
    <meta charset="utf-8">
    <title>search</title>
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <style>
        *{padding:0px;margin:0px;}
        .pop {  display: none;  width: 400px; min-height: 200px;  max-height: 900px;  height:700px;  position: absolute;  top: 0;  left: 0;  bottom: 0;  right: 0;  margin: auto;  padding: 25px;  z-index: 130;  border-radius: 8px;  background-color: #fff;  box-shadow: 0 3px 18px rgba(100, 0, 0, .5);  }
        .pop1 {  display: none;  width: 400px; min-height: 100px;  max-height: 200px;  height:100px;  position: absolute;  top: 0;  left: 0;  bottom: 0;  right: 0;  margin: auto;  padding: 25px;  z-index: 130;  border-radius: 8px;  background-color: #fff;  box-shadow: 0 3px 18px rgba(100, 0, 0, .5);  }
        .pop-top{  height:20px;  width:100%;  border-bottom: 1px #E5E5E5 solid;  }
        .pop-top h2{  float: left; }
        .pop-top span{  float: right;  cursor: pointer;  font-weight: bold; }
        .pop-foot{  height:10px;  line-height:10px;  width:100%;  border-top: 1px #E5E5E5 solid;  text-align: right;  }
        .pop-cancel, .pop-ok {  padding:8px 15px;  margin:15px 5px;  border: none;  border-radius: 5px;  background-color: #337AB7;  color: #fff;  cursor:pointer;  }
        .pop-cancel {  background-color: #FFF;  border:1px #CECECE solid;  color: #000;  }
        .pop-content{  height: 380px;  }
        .pop-content-left{  float: left;  }
        .pop-content-right{  width:310px;  float: left;  padding-top:20px;  padding-left:20px;  font-size: 16px;  line-height:35px;  }
        .bgPop{  display: none;  position: absolute;  z-index: 129;  left: 0;  top: 0;  width: 100%;  height: 100%;  background: rgba(0,0,0,.2);  }
    </style>
    <link type="text/css" rel="stylesheet" href="../css/csssearch.css">
    <script type="text/javascript" src="../js/jquery-easyui-1.8.1/jquery.min.js"></script>
    <script type="text/javascript" src="../js/jquery-easyui-1.8.1/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../js/jquery-easyui-1.8.1/locale/easyui-lang-zh_CN.js"></script>
</head>
<body>
<div>
    <section class="banner" id="top">
        <div class="container">
            <div class="row">
                <div class="col-md-14">
                    <section id="first-tab-group" class="tabgroup">
                        <div id="tab1">
                            <div class="submit-form">
                                <div class="row">
                                    <div class="col-md-2">
                                        <fieldset>
                                            起点：
                                            <select name="start" cssStyle="size: 50px">
                                                <option value="上海">上海</option>
                                                <option value="北京">北京</option>
                                                <option value="广州">广州</option>
                                                <option value="武汉">武汉</option>
                                                <option value="深圳">深圳</option>
                                                <option value="成都">成都</option>
                                                <option value="重庆">重庆</option>
                                                <option value="杭州">杭州</option>
                                                <option value="西安">西安</option>
                                                <option value="天津">天津</option>
                                                <option value="郑州">郑州</option>
                                            </select>
                                        </fieldset>
                                    </div>
                                    <div class="col-md-2">
                                        <fieldset>
                                            终点：
                                            <select name="end" cssStyle="size: 50px">
                                                <option value="上海">上海</option>
                                                <option value="北京">北京</option>
                                                <option value="广州">广州</option>
                                                <option value="武汉">武汉</option>
                                                <option value="深圳">深圳</option>
                                                <option value="成都">成都</option>
                                                <option value="重庆">重庆</option>
                                                <option value="杭州">杭州</option>
                                                <option value="西安">西安</option>
                                                <option value="天津">天津</option>
                                                <option value="郑州">郑州</option>
                                            </select>
                                        </fieldset>
                                    </div>
                                    <div class="col-md-2">
                                        <fieldset>
                                            出发日期：
                                            <input type="date" id="godate"/>
                                        </fieldset>
                                    </div>
                                    <div class="col-md-2">
                                        <fieldset>
                                            <div id="div1">
                                                返回日期：
                                                <input type="date" id="returndate"/>
                                            </div>
                                        </fieldset>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="radio-select">
                                            <div class="row">
                                                <div class="col-md-6 col-sm-6 col-xs-6">
                                                    <label>单程：</label>
                                                    <input type="radio" name="tag" value="1" onclick="one()"/>
                                                </div>
                                                <div class="col-md-6 col-sm-6 col-xs-6">
                                                    <label>往返：</label>
                                                    <input type="radio" name="tag" value="2" onclick="two()"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <fieldset>
                                            <button type="button" id="form-submit" class="btn">查询相应的航班</button>
                                        </fieldset>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </section>
    <input type="button" value="确认购票" onclick="a()" id="b2">
    <div class="row clearfix">
        <div class="col-md-8 column col-md-offset-2">
            <table class="table table-hover table-striped" align="center">
                <thead>
                <tr>
                    <th>去程</th>
                </tr>
                </thead>
                <tr>
                    <td>
                        <table id="t1">
                        </table>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <div class="row clearfix">
        <div class="col-md-8 column col-md-offset-2">
            <table class="table table-hover table-striped" align="center" id="tabb1" style="visibility: hidden">
                <thead>
                <tr>
                    <th>回程</th>
                </tr>
                </thead>
                <tr>
                    <td>
                        <table id="t2">
                        </table>
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>
<!--遮罩层-->
<div class="bgPop"></div>
<!--弹出框-->
<div class="pop">
    <div class="pop-top">
        <h2></h2>
        <span class="pop-close" onclick="b()">Ｘ</span>
    </div>
    <div class="pop-content">
        <div class="pop-content-left">
            <img src="" alt="" class="teathumb">
        </div>
        <div class="pop-content-right">
            <label>确认机票信息并选择舱位</label><br>
            去程：
            <table align="center">
                <tr id="td1">
                    <td>航班号：</td><td><br></td>
                </tr>
                <tr id="td2">
                    <td>出发地：</td><td><br></td>
                </tr>
                <tr id="td3">
                    <td>目的地：</td><td><br></td>
                </tr>
                <tr id="td4">
                    <td>起飞时间：</td><td><br></td>
                </tr>
                <tr id="td5">
                    <td>到达时间：</td><td><br></td>
                </tr>
                <tr id="td6">
                    <td>票价：</td><td><br></td>
                </tr>
                <tr>
                    <td>选择舱位：</td><td><input type="radio" value="T" name="c1"/>头等舱&nbsp
                    <input type="radio" value="J" name="c1" checked="checked"/>经济舱</td>
                </tr>
                <br>
            </table>
            <div id="hidden1" style="visibility: hidden">
                <hr>
                回程：
                <table align="center">
                    <tr id="td7">
                        <td>航班号：</td>
                        <td><br></td>
                    </tr>
                    <tr id="td8">
                        <td>出发地：</td>
                        <td><br></td>
                    </tr>
                    <tr id="td9">
                        <td>目的地：</td>
                        <td><br></td>
                    </tr>
                    <tr id="td10">
                        <td>起飞时间：</td>
                        <td><br></td>
                    </tr>
                    <tr id="td11">
                        <td>到达时间：</td>
                        <td><br></td>
                    </tr>
                    <tr id="td12">
                        <td>票价：</td>
                        <td><br></td>
                    </tr>
                    <tr>
                        <td>选择舱位：</td><td><input type="radio" value="T" name="c2"/>头等舱&nbsp
                        <input type="radio" value="J" name="c2" checked="checked"/>经济舱</td>
                    </tr>
                    <br>
                </table>
            </div>
            <br><br>
            <div class="pop-foot">
                <input type="button" value="关闭" class="pop-cancel pop-close" onclick="b()">
                <input type="button" value="购票" class="pop-ok" id="buy">
            </div>
        </div>
    </div>
</div>
</body>
<script>
    function a() {
        var type = sessionStorage.getItem("type");
        var fid1 = $("[name=fid1]:checked").val();
        sessionStorage.setItem("fid1",fid1);
        var str={
            "flightId" : fid1
        };
        $.ajax({
            url : "http://localhost:8080/flight/searchflightbyid",
            type : "post",
            contentType:'application/json;charset=utf-8',
            dataType:'json',
            data: JSON.stringify(str),
            success : function(datas) {
                $("#td1").find("td").eq(1).html(datas.flight.flightId);
                $("#td2").find("td").eq(1).html(datas.flight.start);
                $("#td3").find("td").eq(1).html(datas.flight.end);
                $("#td4").find("td").eq(1).html(datas.flight.starttime);
                $("#td5").find("td").eq(1).html(datas.flight.endtime);
                $("#td6").find("td").eq(1).html(datas.flight.topprice+"元 /"+datas.flight.lowprice+"元");
            }
        });

        if(type==2){
            document.getElementById("hidden1").style.visibility="visible";
            var fid2 = $("[name=fid2]:checked").val();
            sessionStorage.setItem("fid2",fid2);
            var str={
                "flightId" : fid2
            };
            $.ajax({
                url : "http://localhost:8080/flight/searchflightbyid",
                type : "post",
                contentType:'application/json;charset=utf-8',
                dataType:'json',
                data: JSON.stringify(str),
                success : function(datas) {
                    $("#td7").find("td").eq(1).html(datas.flight.flightId);
                    $("#td8").find("td").eq(1).html(datas.flight.start);
                    $("#td9").find("td").eq(1).html(datas.flight.end);
                    $("#td10").find("td").eq(1).html(datas.flight.starttime);
                    $("#td11").find("td").eq(1).html(datas.flight.endtime);
                    $("#td12").find("td").eq(1).html(datas.flight.topprice+"元 /"+datas.flight.lowprice+"元");
                }
            });
        }
        $('.bgPop,.pop').show();
    }
    function b() {
        $('.bgPop,.pop').hide();
    }
</script>
<script>
    function one() {
        document.getElementById("div1").style.visibility="hidden";
    }
    function two() {
        document.getElementById("div1").style.visibility="visible";
    }
</script>
<script>
    window.onload=function (){
        var userId = sessionStorage.getItem("userId");
        var type = sessionStorage.getItem("type");
        var start = sessionStorage.getItem("start");
        var end = sessionStorage.getItem("end");
        var godate = sessionStorage.getItem("godate");
        var returndate = sessionStorage.getItem("returndate");
        if(type == 1){
            var str={
                "start" : start,
                "end" : end,
                "date" : godate
            };
            $.ajax({
                url: "http://localhost:8080/flight/searchflight",
                type: "post",
                contentType: 'application/json;charset=utf-8',
                dataType: 'json',
                data: JSON.stringify(str),
                success: function (datas) {
                    $str = '';
                    $.each(datas.goflightlist,function(i,val){
                        $str = $str + '<tr>';
                        $str = $str + '<td rowspan="2" width="200"><h4> '+val.flightId+'  </h4></td>';
                        $str = $str + '<td height="30" width="200"><h4> '+val.start+'  </h4></td>';
                        $str = $str + '<td height="30" width="200"><h4> '+val.end+'  </h4></td>';
                        $str = $str + '<td height="30" width="200"><h4>￥ '+val.lowprice+'  </h4></td>';
                        $str = $str + '<td rowspan="2" width="200">' + '点击选择<input type="radio" name="fid1"value="'+val.flightId+'"/>' + ' </td>';
                        $str = $str + '</tr>';
                        $str = $str + '<tr>';
                        $str = $str + '<td height="30"><h4> '+val.starttime+'  </h4></td>';
                        $str = $str + '<td height="30"><h4> '+val.endtime+'  </h4></td>';
                        $str = $str + '<td height="30"><h4>￥ '+val.topprice+'  </h4></td>';
                        $str = $str + '</tr>';
                    });
                    $('#t1').append($str);
                }
            });
        }
        else if(type == 2) {
            document.getElementById("tabb1").style.visibility="visible";
            var str={
                "start" : start,
                "end" : end,
                "godate" : godate,
                "returndate" : returndate,
            };
            $.ajax({
                url: "http://localhost:8080/flight/searchflighttwo",
                type: "post",
                contentType: 'application/json;charset=utf-8',
                dataType: 'json',
                data: JSON.stringify(str),
                success: function (datas) {
                    $str = '';
                    $str1 = '';
                    $.each(datas.goflightlist,function(i,val){
                        $str = $str + '<tr>';
                        $str = $str + '<td rowspan="2" width="200"><h4> '+val.flightId+'  </h4></td>';
                        $str = $str + '<td height="30" width="200"><h4> '+val.start+'  </h4></td>';
                        $str = $str + '<td height="30" width="200"><h4> '+val.end+'  </h4></td>';
                        $str = $str + '<td height="30" width="200"><h4>￥ '+val.lowprice+'  </h4></td>';
                        $str = $str + '<td rowspan="2" width="200">' + '点击选择<input type="radio" name="fid1"value="'+val.flightId+'"/>' + ' </td>';
                        $str = $str + '</tr>';
                        $str = $str + '<tr>';
                        $str = $str + '<td height="30"><h4> '+val.starttime+'  </h4></td>';
                        $str = $str + '<td height="30"><h4> '+val.endtime+'  </h4></td>';
                        $str = $str + '<td height="30"><h4>￥ '+val.topprice+'  </h4></td>';
                        $str = $str + '</tr>';
                    });
                    $.each(datas.returnflightlist,function(i,val){
                        $str1 = $str1 + '<tr>';
                        $str1 = $str1 + '<td rowspan="2" width="200"><h4> '+val.flightId+'  </h4></td>';
                        $str1 = $str1 + '<td height="30" width="200"><h4> '+val.start+'  </h4></td>';
                        $str1 = $str1 + '<td height="30" width="200"><h4> '+val.end+'  </h4></td>';
                        $str1 = $str1 + '<td height="30" width="200"><h4>￥ '+val.lowprice+'  </h4></td>';
                        $str1 = $str1 + '<td rowspan="2" width="200">' + '点击选择<input type="radio" name="fid2"value="'+val.flightId+'"/>' + ' </td>';
                        $str1 = $str1 + '</tr>';
                        $str1 = $str1 + '<tr>';
                        $str1 = $str1 + '<td height="30"><h4> '+val.starttime+'  </h4></td>';
                        $str1 = $str1 + '<td height="30"><h4> '+val.endtime+'  </h4></td>';
                        $str1 = $str1 + '<td height="30"><h4>￥ '+val.topprice+'  </h4></td>';
                        $str1 = $str1 + '</tr>';
                    });
                    $('#t1').append($str);
                    $('#t2').append($str1);
                }
            });
        }
        else
        {
            return;
        }
    }
</script>
<script type="text/javascript">
    $("#form-submit").click(function() {
        var start = $("[name=start]").val();
        var end = $("[name=end]").val();
        var godate = $("[id=godate]").val();
        var returndate = $("[id=returndate]").val();
        var type = $("[name=tag]:checked").val();
        var userId = sessionStorage.getItem("userId");
        if (userId == null) {
            alert("请登录");
            window.location.href = "login.html";
        }
        sessionStorage.setItem("start", start);
        sessionStorage.setItem("end", end);
        sessionStorage.setItem("godate", godate);
        sessionStorage.setItem("returndate", returndate);
        sessionStorage.setItem("type", type);
        window.location.href = "search.html";
    })
</script>
<script type="text/javascript">
    $("#buy").click(function() {
        var type = sessionStorage.getItem("type");
        if(type==1){
            var userId = sessionStorage.getItem("userId");
            var flightId = sessionStorage.getItem("fid1");
            var seattype = $("[name=c1]:checked").val();
            var str={
                "userId" : userId,
                "flightId" : flightId,
                "seattype" : seattype
            };
            $.ajax({
                url : "http://localhost:8080/flight/buyticket",
                type : "post",
                contentType:'application/json;charset=utf-8',
                dataType:'json',
                data: JSON.stringify(str),
                success : function(datas) {
                    if(datas.hasOwnProperty("error")){
                        alert(datas["error"]);
                    }
                    else
                    {
                        alert("购票成功");
                        window.location.href="main.html";
                    }
                }
            });
        }
        else if(type==2){
            var userId = sessionStorage.getItem("userId");
            var flightId = sessionStorage.getItem("fid1");
            var seattype = $("[name=c1]:checked").val();
            var str={
                "userId" : userId,
                "flightId" : flightId,
                "seattype" : seattype
            };
            $.ajax({
                url : "http://localhost:8080/flight/buyticket",
                type : "post",
                contentType:'application/json;charset=utf-8',
                dataType:'json',
                data: JSON.stringify(str),
                success : function(datas) {
                    if(datas.hasOwnProperty("error")){
                        alert(datas["error"]);
                    }
                    else
                    {
                        var userId2 = sessionStorage.getItem("userId");
                        var flightId2 = sessionStorage.getItem("fid2");
                        var seattype2 = $("[name=c2]:checked").val();
                        alert(userId);
                        var str={
                            "userId" : userId2,
                            "flightId" : flightId2,
                            "seattype" : seattype2
                        };
                        $.ajax({
                            url : "http://localhost:8080/flight/buyticket",
                            type : "post",
                            contentType:'application/json;charset=utf-8',
                            dataType:'json',
                            data: JSON.stringify(str),
                            success : function(datas) {
                                if(datas.hasOwnProperty("error")){
                                    alert(datas["error"]);
                                }
                                else
                                {
                                    alert("购票成功");
                                    window.location.href="main.html";
                                }
                            }
                        });
                    }
                }
            });
        }
        else{
            return;
        }
    })
</script>
</html>
